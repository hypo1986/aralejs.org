<!DOCTYPE HTML>
<html lang="zh">
  <head>
    <meta charset="UTF-8">
    <title>Arale - 模块线上状态</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="nico 0.2.3" />
    <link type="image/x-icon" href="../static/css/favicon.ico" rel="icon">
    <link rel="stylesheet" href="../static/css/normalize.css" />
    <link rel="stylesheet" href="../static/css/site.css" />
    <link rel="stylesheet" href="../static/css/solarized.css" />
    <script src="http://static.alipayobjects.com/seajs/1.3.1/sea.js"></script>
    <script src="../static/js/arale-helper.js"></script>
    <script src="../static/js/site.js"></script><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36247332-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://ssl.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script>
  (function() {
    var data;
    seajs._package = data = {"name":"Arale","version":"0.0.1","root":"","description":"{ 基于 SeaJS 的前端解决方案，随<span class='heart'>❤</span>构建互联网应用 }","homepage":"http://aralejs.org","repository":{"type":"git","url":"https://github.com/aralejs/aralejs.org"},"bugs":{"url":"https://github.com/aralejs/aralejs.org/issues"}}

    if (data.spm && data.spm.alias) {
      delete data.spm.alias['$']
      seajs.config({ alias: data.spm.alias})
    } else {
      data.dependencies && (delete data.dependencies['$'])
      seajs.config({ alias: data.dependencies })
    }

    seajs.config({ alias: {} })

    // for alice
    for(var dep in data.dependencies) {
        // 如果依赖的是样式模块
        if (data.dependencies[dep].indexOf('.css') > 0) {
            seajs.use(dep);
        }
    }
  })();
</script>
    <!--[if lt IE 9]>
    <script src="../static/js/html5shiv.js"></script>
    <![endif]-->
    
<link rel="stylesheet" href="../static/style.css" />
<script src="../static/index.js"></script>

  </head>
  <body>
    <div id="body-wrapper">
      
<div id="title-wrapper">            
  <h1 id="title" class="inline">
    <a href="../">Arale</a>
  </h1>
  <input type="text" class="inline" id="search" placeholder="搜索 Arale 模块">
  <p id="description">{ 基于 SeaJS 的前端解决方案，随<span class='heart'>❤</span>构建互联网应用 }</p>
</div>
<div id="main-wrapper">
  <div class="main-block" id="document-wrapper">
    <div>
      <h2>Document</h2>
      <ol id="sidenav">
        <li><a href="../docs/about-arale.html">关于 Arale</a></li>
        <li><a href="../docs/getting-started.html">5 分钟快速上手</a></li>
        <li><a href="../docs/develop-components.html">开发一个 Arale 模块</a></li>
        <li><a href="../docs/online-status.html">模块线上状态</a></li>
        <li><a href="../docs/rules.html">开发规范</a></li>
        <li><a href="../docs/alice.html">Alice 样式解决方案</a></li>
        <li><a href="../contributing.html">加入我们</a></li>
      </ol>
    </div>
    <div style="display:none" id="J-alipay">
      <h2>Alipay</h2>
      <ol id="sidenav">
        <li><a href="../docs/alipay-overview.html">支付宝入门指南</a></li>
      </ol>
    </div>
  </div>
  <div class="main-block" id="doc-wrapper">
    <h1>模块线上状态</h1>
    <div id="content"><style>
.J-alipayStatus{display:none}
</style>

<p>本页面提供了现有组件的发布状态，可以查看某组件的所有版本，以及其具体版本是否已上线。</p>

<ul>
<li><span class="assert" style="color:#1A9B20">✔</span> 所有文件均存在。</li>
<li><span class="assert" style="color:#FF4C4C">✗</span> 所有文件均不存在。 </li>
<li><span class="assert" style="color: #FFB800;">✙</span> 部分文件存在，可能存在漏发或多余的文件。</li>
</ul>

<p>请尽量使用最新版，如测试环境不存在该文件，可联系我们，或使用次新版。</p>
<h2 id="arale">Arale</h2>
<div id="status-arale"></div>
<h2 id="gallery">Gallery</h2>
<div id="status-gallery"></div>
<h2 id="alipay">Alipay</h2>
<div id="status-alipay" class="J-alipayStatus"></div>

<div id="card"></div>

<style>
#doc-wrapper, table {width: 100%}
table td, table th {text-align:left;padding: 5px 0;}
table .status {width: 80px; cursor: pointer; padding: 0px 10px;}
table .status:hover {background-color: #fff;}
table .status span{cursor:pointer;}
table .version{width: 180px;}
#content table .name a {color: #6381A6;}
#card{width:auto;}
.face {
    font-weight: bold;
    margin-right: 6px;
    color: #FF7207;
}
</style>

<script>
seajs.config({
    alias: {
        'status-arale': 'http://aralejs.org/status-arale.js',
        'status-arale-dev': 'http://arale.alipay.im/status-arale.js',
        'status-gallery': 'http://aralejs.org/status-gallery.js',
        'status-gallery-dev': 'http://arale.alipay.im/status-gallery.js',
        'status-alipay': 'http://arale.alipay.im/status-alipay.js'
    }
});

seajs.use(['$', 'popup'], function($, Popup){
    var globalData = {},
        prefix = {
            online: 'https://a.alipayobjects.com',
            test: 'https://a.test.alipay.net',
            dev: 'http://assets.dev.alipay.net'
        };

    test(function() {
        seajs.use(['status-arale-dev'], function(data) {
            globalData['arale'] = data;
            createTable(data, 'arale');
            $('.J-alipayStatus').show();
        });

        seajs.use(['status-gallery-dev'], function(data) {
            globalData['gallery'] = data;
            createTable(data, 'gallery');
            $('.J-alipayStatus').show();
        });
    }, function() {
        seajs.use(['status-arale'], function(data) {
            globalData['arale'] = data;
            createTable(data, 'arale');
        });

        seajs.use(['status-gallery'], function(data) {
            globalData['gallery'] = data;
            createTable(data, 'gallery');
        });
    });
    
    seajs.use(['status-alipay'], function(data) {
        if(!data) return;
        globalData['alipay'] = data;
        createTable(data, 'alipay');
        $('.J-alipayStatus').show();
    });

    function test(success, failure) {
        var isCalled = false;
        seajs.use(['status-alipay'], function(data) {
            if (!isCalled) {
                if (data) {
                    success();
                    isCalled = true;
                } else {
                    failure();
                    isCalled = true;
                }
            }
        });
        setTimeout(function() {
            if (!isCalled) {
                failure();
                isCalled = true;
            }
        }, 500);
        //$.ajax({
        //    url: 'http://aralejs.alipay.im/status-alipay.js',
        //    dataType: 'script',
        //    timeout: 500,
        //    success: function() {
        //        success();
        //    },
        //    error: function() {
        //        failure();
        //    }
        //});
    }
    
    function createTable(data, root) {
        var table = $('<table><tr><th class="name">组件名</th><th class="version">版本</th><th class="status J-alipayStatus">开发环境</th><th class="status J-alipayStatus">测试环境</th><th class="status">线上</th></tr></table>').appendTo('#status-' + root);

        $.each(data, function(key, value){
            var name = key;
    
            // 生成所有版本
            var s = ['<select>'];
            $.each(value, function(key, value){
                var files = [], version = key;
                $.each(value, function(key, value){
                    files.push([root, name, version, key].join('/'));
                });
                s.push('<option value="' + version + '" data-files="' + files.join(';') + '">' + version + '</option>');
            });
            s.push('</select>');
            
            var keylink = '';
            if (root === 'arale') {
                keylink = '<a href="/' + key + '/">' + key + '</a>';
            } else if (root === 'alipay') {
                keylink = '<a href="http://arale.alipay.im/' + root + '/' + key + '/">' + key + '</a>';
            } else {
                keylink = key;
            }
    
            var tr = $('<tr data-name="' +  key + '" data-root="' + root + '" id="' + root + '-' + key + '">' +
                '<td class="name"><span class="face">☺</span> ' + keylink + '</td>' +
                '<td class="version">' + s.join('') + '</td>' +
                '<td class="dev status J-alipayStatus" data-status="dev"></td>' +
                '<td class="test status J-alipayStatus" data-status="test"></td>' +
                '<td class="online status" data-status="online"></td>' +
                '</tr>');
            table.append(tr);

            testStatus(tr.find('select')[0]);

            tr.find('.status').each(function() {
                var item = this;
                new Popup({
                    trigger: item,
                    element: '#card',
                    align: {
                        baseXY: [0, '50%'],
                        selfXY: ['100%+5', '50%']
                    }
                }).before('show', function(){
                    var selected = $(item).parents('tr').find('select :selected'),
                        files = selected.data('files');

                    files = $.map(files.split(';'), function(o){
                        var s = $(item).data('status');
                        var part = o.match(/^([^/]*)\/([^/]*)\/([^/]*)\/(.*)$/);
                        var link = prefix[s] + '/' + o;
                        var status = globalData[part[1]][part[2]][part[3]][part[4]][s];
                        return '<div>' + (status == 200 ? assert(1) : assert(0)) +
                            '<a href="' + link + '" target="_blank" style="margin-left:5px;">' + link + '</a></div>';
                    });
                    $('#card').html(files.join(''));
                });
            });
        });

        $('#status-' + root).on('change', 'select', function() {
            testStatus(this);
        });
        
        // 为了让 aralejs.org/docs/online-status.html#arale.dialog
        // 这样的链接锚点能够正确的指向
        if (location.hash !== '' && $(location.hash)[0]
            && $(location.hash).attr('highlight') !== 'true') {
            location.href = location.href;
            $(location.hash).css({
                'background-color': '#CDEDAC',
                'font-weight': 'bold'
            });
            $(location.hash).attr('highlight', 'true');
        }
    }

    // 检测某个组件的版本在各环境是否存在
    function testStatus(o){
        var f = [], count = 0,
            dev = test = online = 1,
            deverror = testerror = onlineerror = 0;
            tr =  $(o).parents('tr');
            root = tr.data('root'),
            name = tr.data('name'),
            version = o.value,
            files = globalData[root][name][version];

            for(file in files) {
                f.push(file);
                if (files[file]['dev'] !== 200) {
                    dev = 2;
                    deverror++;
                }
                if (files[file]['test'] !== 200) {
                    test = 2;
                    testerror++;
                }
                if (files[file]['online'] !== 200) {
                    online = 2;
                    onlineerror++;
                }
                count++;
            }
            if (deverror === count) {
                dev = 0;
            }
            if (testerror === count) {
                test = 0;
            }
            if (onlineerror === count) {
                online = 0;
            }

            tr.find('.dev').html(assert(dev));
            tr.find('.test').html(assert(test));
            tr.find('.online').html(assert(online));
    }

    // 1:true 0:false 2:half
    function assert(value) {
        if (value === 1) {
            return '<span class="assert" style="color:#1A9B20">✔</span>';
        } else if(value === 0) {
            return '<span class="assert" style="color:#FF4C4C">✗</span>'
        } else if(value === 2) {
            return '<span class="assert" style="color: #FFB800;">✙</span>'
        }
    }
});

</script>
</div>
  </div>
</div>

    </div>
    <div id="footer-wrapper">
      <footer>
        <p class="powered">
<script type="text/javascript" charset="utf-8">
(function(){
  var _w = 72 , _h = 16;
  var param = {
    url:location.href,
    type:'3',
    count:'1', /**是否显示分享数，1显示(可选)*/
    appkey:'', /**您申请的应用appkey,显示分享来源(可选)*/
    title:'', /**分享的文字内容(可选，默认为所在页面的title)*/
    pic:'http://aralejs.org/static/arale.png', /**分享图片的路径(可选)*/
    ralateUid:'', /**关联用户的UID，分享微博会@该用户(可选)*/
	language:'zh_cn', /**设置语言，zh_cn|zh_tw(可选)*/
    rnd:new Date().valueOf()
  }
  var temp = [];
  for( var p in param ){
    temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )
  }
  document.write('<iframe allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')
})()
</script>
<a href="http://aralejs.org">Arale</a> •
<a href="http://aliceui.org">Alice</a> •
<a href="http://seajs.org">SeaJS</a> •
<a href="https://github.com/spmjs/spm">spm</a> •
<a href="http://lab.lepture.com/nico/">nico</a>

        </p>
      </footer>
    </div>
  </body>
</html>